<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV DISPLAY - LIVE SCORE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

    <style>
        :root { 
            --primary-start: #222222; --primary-end: #111111; --live-neon: #76FF03; --bg-color: #000000; --text-color: #fff;
            --card-radius: 20px; --font-main: 'Montserrat', sans-serif;
        }
        
        body { font-family: var(--font-main); background-color: var(--bg-color); margin: 0; padding: 0; color: var(--text-color); overflow: hidden; display: flex; flex-direction: column; height: 100vh; user-select: none; box-sizing: border-box;}
        
        #tv-grid { flex: 1; padding: 2vh 2vw; display: grid; gap: 2vw; align-content: center; width: 100vw; box-sizing: border-box; overflow: hidden; position: relative; z-index: 5;}
        
        #tv-grid.grid-1 { grid-template-columns: 1fr; grid-template-rows: 1fr; padding: 5vh 10vw;}
        #tv-grid.grid-2 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr; }
        #tv-grid.grid-3, #tv-grid.grid-4 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
        #tv-grid.grid-5, #tv-grid.grid-6 { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr 1fr; }
        
        .match-card { display: flex; flex-direction: column; justify-content: space-between; padding: 1.5vw; border-radius: var(--card-radius); height: 100%; box-sizing: border-box; transition: all 0.5s; position: relative; min-width: 0; min-height: 0; overflow: hidden;}
        
        .grid-1 .team-name { font-size: 3.5vw; } .grid-1 .set-txt { font-size: 5vw; } .grid-1 .point-txt { font-size: 2.5vw; margin-top: 2vh; padding: 1vh 2vw; } .grid-1 .court-badge { font-size: 1.5vw; } .grid-1 .meta-text { font-size: 1.2vw; }
        .grid-2 .team-name { font-size: 2.2vw; } .grid-2 .set-txt { font-size: 3.5vw; } .grid-2 .point-txt { font-size: 1.8vw; margin-top: 1.5vh; padding: 0.8vh 1.5vw; } .grid-2 .court-badge { font-size: 1.2vw; } .grid-2 .meta-text { font-size: 1vw; }
        .grid-3 .team-name, .grid-4 .team-name { font-size: 1.8vw; } .grid-3 .set-txt, .grid-4 .set-txt { font-size: 2.5vw; } .grid-3 .point-txt, .grid-4 .point-txt { font-size: 1.3vw; margin-top: 1vh; padding: 0.5vh 1.2vw; } .grid-3 .court-badge, .grid-4 .court-badge { font-size: 1vw; } .grid-3 .meta-text, .grid-4 .meta-text { font-size: 0.9vw; }
        .grid-5 .team-name, .grid-6 .team-name { font-size: 1.5vw; } .grid-5 .set-txt, .grid-6 .set-txt { font-size: 2vw; } .grid-5 .point-txt, .grid-6 .point-txt { font-size: 1vw; margin-top: 0.5vh; padding: 0.3vh 1vw; } .grid-5 .court-badge, .grid-6 .court-badge { font-size: 0.9vw; padding: 0.3vw 0.8vw; } .grid-5 .meta-text, .grid-6 .meta-text { font-size: 0.8vw; }

        .meta-text { font-weight: 900; text-transform: uppercase; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70%;}
        .court-badge { border-radius: 8px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; display: inline-block; box-shadow: 0 5px 15px rgba(0,0,0,0.2);}
        .team { flex: 1; font-weight: 800; line-height: 1.2; display: flex; flex-direction: column; justify-content: center; width: 27.5%; overflow: hidden; min-width: 0; }
        
        .score-pill { background: linear-gradient(135deg, var(--primary-start), var(--primary-end)); color: white; border-radius: 15px; min-width: 15vw; max-width: 45%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin: 0 1vw; display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1.1; border: 2px solid rgba(255,255,255,0.1); flex-shrink: 0; padding: 1vh 1vw;}
        .set-txt { font-weight: 900; }
        .point-txt { font-weight: 900; letter-spacing: 2px; background: rgba(0,0,0,0.2); border-radius: 10px; display: inline-block; color: inherit; text-align: center; }

        @keyframes pulse-live-card { 0% { box-shadow: 0 0 5px var(--live-neon); transform: scale(1); border-color: transparent;} 100% { box-shadow: 0 0 20px var(--live-neon); transform: scale(1.02); border-color: var(--live-neon); } }
        .match-card.is-live { border: 3px solid var(--live-neon); animation: pulse-live-card 2s infinite alternate ease-in-out; z-index: 20; }
        
        .live-tag { color: #fff; background: var(--primary-start); font-weight: 900; font-size: 0.9vw; display: flex; align-items: center; gap: 0.5vw; padding: 0.4vw 0.8vw; border-radius: 8px; letter-spacing: 1px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); flex-shrink: 0;}
        .dot-live { display: inline-block; width: 0.8vw; height: 0.8vw; background-color: var(--live-neon) !important; border-radius: 50%; animation: blinker-live 0.8s infinite alternate;}
        @keyframes blinker-live { 0% { opacity: 0.2; } 100% { opacity: 1; box-shadow: 0 0 15px var(--live-neon); } }
        .neon-dot { flex-shrink: 0; width: 0.8vw; height: 0.8vw; background-color: var(--live-neon); border-radius: 50%; box-shadow: 0 0 10px var(--live-neon); }

        .theme-classic-white { background: white; color: #333; } .theme-classic-white .meta-text { color: #C2185B; } .theme-classic-white .court-badge { background: #f5f5f5; color: #666; border: 1px solid #ddd; } 
        .theme-midnight-blue { background: #0d1b2a; color: #e0e1dd; border: 1px solid #1b263b; } .theme-midnight-blue .meta-text { color: #4CC9F0; } .theme-midnight-blue .court-badge { background: #1b263b; color: #4CC9F0; } 
        .theme-royal-gold { background: #fffcf5; color: #5d4037; border: 1px solid #daa520; } .theme-royal-gold .meta-text { color: #b8860b; } .theme-royal-gold .court-badge { background: linear-gradient(to bottom, #fff8dc, #f0e68c); color: #5d4037; border: 1px solid #daa520; }
        .theme-vampire-red { background: #1a0000; color: #ffcccc; border: 1px solid #4d0000; } .theme-vampire-red .meta-text { color: #FF5252; } .theme-vampire-red .court-badge { background: #4d0000; color: white; }
        .theme-ocean-breeze { background: #E1F5FE; color: #01579B; border: 1px solid #81d4fa; } .theme-ocean-breeze .meta-text { color: #0288d1; } .theme-ocean-breeze .court-badge { background: #0288D1; color: white; }
        .theme-neon-cyber { background: #050505; border: 1px solid #0ff; color: #0ff; } .theme-neon-cyber .meta-text { color: #fff; text-shadow: 0 0 5px #fff; } .theme-neon-cyber .court-badge { background: #002222; color: #fff; border: 1px solid #0ff; }
        .theme-emerald-city { background: #e8f5e9; color: #1b5e20; border: 1px solid #c8e6c9; } .theme-emerald-city .meta-text { color: #2e7d32; } .theme-emerald-city .court-badge { background: #4caf50; color: white; }
        .theme-sunset-glow { background: #fff3e0; color: #e65100; border: 1px solid #ffe0b2; } .theme-sunset-glow .meta-text { color: #f57c00; } .theme-sunset-glow .court-badge { background: #ff9800; color: white; }
        .theme-monochrome { background: #fafafa; color: #000; border: 2px solid #000; border-radius:0 !important; } .theme-monochrome .court-badge { background: #000; color: #fff; border-radius:0; }
        .theme-lavender { background: #f3e5f5; color: #4a148c; border: 1px solid #e1bee7; } .theme-lavender .court-badge { background: #ab47bc; color: white; }
        .theme-crimson { background: #ffebee; color: #b71c1c; border: 1px solid #ffcdd2; } .theme-crimson .court-badge { background: #e53935; color: white; }
        .theme-aqua-glass { background: rgba(224,247,250,0.7); backdrop-filter: blur(10px); color: #006064; border: 1px solid rgba(255,255,255,0.5); } .theme-aqua-glass .court-badge { background: #00bcd4; color: white; }
        .theme-forest-dark { background: #1b5e20; color: #e8f5e9; border: 1px solid #388e3c; } .theme-forest-dark .court-badge { background: #4caf50; color: white; }
        .theme-rose-gold { background: #fce4ec; color: #880e4f; border: 1px solid #f8bbd0; } .theme-rose-gold .meta-text { color: #d81b60; } .theme-rose-gold .court-badge { background: #f06292; color: white; }
        .theme-matrix-code { background: black; color: #00ff00; font-family: 'Courier Prime', monospace; } .theme-matrix-code .court-badge { border: 1px solid #00ff00; color: #00ff00; background: transparent; }
        .theme-obsidian { background: #0f0f0f; color: #f5f5f5; border: 1px solid #333; } .theme-obsidian .meta-text { color: #ffeb3b; } .theme-obsidian .court-badge { background: #222; color: #ffeb3b; }
        .theme-pearl { background: #fdfdfd; color: #444; border: 1px solid #e0e0e0; } .theme-pearl .meta-text { color: #880e4f; } .theme-pearl .court-badge { background: #eee; color: #880e4f; }
        .theme-ruby { background: #ffebee; color: #b71c1c; border: 1px solid #ff8a80; } .theme-ruby .court-badge { background: #b71c1c; color: white; }
        .theme-sapphire { background: #e3f2fd; color: #0d47a1; border: 1px solid #82b1ff; } .theme-sapphire .court-badge { background: #0d47a1; color: white; }
        .theme-amethyst { background: #f3e5f5; color: #4a148c; border: 1px solid #ea80fc; } .theme-amethyst .court-badge { background: #4a148c; color: white; }
        .theme-topaz { background: #fffde7; color: #e65100; border: 1px solid #ffd180; } .theme-topaz .court-badge { background: #e65100; color: white; }
        .theme-amber { background: #fff8e1; color: #f57f17; border: 1px solid #ffe57f; } .theme-amber .court-badge { background: #f57f17; color: white; }
        .theme-quartz { background: #fce4ec; color: #c2185b; border: 1px solid #ff80ab; } .theme-quartz .court-badge { background: #c2185b; color: white; }
        .theme-jade { background: #e8f5e9; color: #1b5e20; border: 1px solid #b9f6ca; } .theme-jade .court-badge { background: #1b5e20; color: white; }
        .theme-onyx { background: #212121; color: #fafafa; border: 1px solid #424242; } .theme-onyx .meta-text { color: #ff5252; } .theme-onyx .court-badge { background: #424242; color: #ff5252; }
        .theme-coral { background: #fbe9e7; color: #bf360c; border: 1px solid #ff9e80; } .theme-coral .court-badge { background: #bf360c; color: white; }
        .theme-turquoise { background: #e0f2f1; color: #004d40; border: 1px solid #a7ffeb; } .theme-turquoise .court-badge { background: #004d40; color: white; }
        .theme-malachite { background: #11270b; color: #a5d6a7; border: 1px solid #2e7d32; } .theme-malachite .meta-text { color: #69f0ae; } .theme-malachite .court-badge { background: #2e7d32; color: white; }
        .theme-opal { background: linear-gradient(120deg, #fdfbfb, #ebedee); color: #37474f; border: 1px solid #cfd8dc; } .theme-opal .court-badge { background: #b0bec5; color: #263238; }
        .theme-moonstone { background: #eceff1; color: #263238; border: 1px solid #b0bec5; } .theme-moonstone .court-badge { background: #78909c; color: white; }
        .theme-sunstone { background: #fff3e0; color: #e65100; border: 1px solid #ffcc80; } .theme-sunstone .court-badge { background: #e65100; color: white; }
        .theme-garnet { background: #3e2723; color: #ffccbc; border: 1px solid #5d4037; } .theme-garnet .meta-text { color: #ff5722; } .theme-garnet .court-badge { background: #5d4037; color: #ff5722; }
        .theme-peridot { background: #f1f8e9; color: #33691e; border: 1px solid #ccff90; } .theme-peridot .court-badge { background: #33691e; color: white; }
        .theme-citrine { background: #fff9c4; color: #f57f17; border: 1px solid #ffff8d; } .theme-citrine .court-badge { background: #f57f17; color: white; }
        .theme-spinel { background: #f8bbd0; color: #880e4f; border: 1px solid #ff80ab; } .theme-spinel .court-badge { background: #880e4f; color: white; }
        .theme-zircon { background: #e1f5fe; color: #01579b; border: 1px solid #80d8ff; } .theme-zircon .court-badge { background: #01579b; color: white; }
        .theme-tourmaline { background: linear-gradient(135deg, #f3e5f5, #e8f5e9); color: #333; border: 1px solid #ce93d8; } .theme-tourmaline .court-badge { background: #ab47bc; color: white; }
        .theme-beryl { background: #e0f7fa; color: #006064; border: 1px solid #84ffff; } .theme-beryl .court-badge { background: #006064; color: white; }
        .theme-alexandrite { background: #311b92; color: #b388ff; border: 1px solid #512da8; } .theme-alexandrite .meta-text { color: #ea80fc; } .theme-alexandrite .court-badge { background: #512da8; color: white; }
        .theme-tanzanite { background: #ede7f6; color: #4527a0; border: 1px solid #b388ff; } .theme-tanzanite .court-badge { background: #4527a0; color: white; }
        .theme-bloodstone { background: #1b1b1b; color: #ef9a9a; border: 1px solid #b71c1c; } .theme-bloodstone .court-badge { background: #b71c1c; color: white; }
        .theme-iolite { background: #283593; color: #c5cae9; border: 1px solid #3f51b5; } .theme-iolite .meta-text { color: #8c9eff; } .theme-iolite .court-badge { background: #3f51b5; color: white; }
        .theme-lapis { background: #1a237e; color: #e8eaf6; border: 1px solid #3949ab; } .theme-lapis .meta-text { color: #ffd740; } .theme-lapis .court-badge { background: #3949ab; color: white; }
        .theme-morganite { background: #ffebee; color: #c2185b; border: 1px solid #ff80ab; } .theme-morganite .court-badge { background: #c2185b; color: white; }
        .theme-kunzite { background: #fce4ec; color: #880e4f; border: 1px solid #ff4081; } .theme-kunzite .court-badge { background: #880e4f; color: white; }
        .theme-tsavorite { background: #e8f5e9; color: #1b5e20; border: 1px solid #00c853; } .theme-tsavorite .court-badge { background: #1b5e20; color: white; }
        .theme-rhodolite { background: #880e4f; color: #fce4ec; border: 1px solid #ad1457; } .theme-rhodolite .meta-text { color: #ff80ab; } .theme-rhodolite .court-badge { background: #ad1457; color: white; }
        .theme-spessartite { background: #bf360c; color: #fbe9e7; border: 1px solid #d84315; } .theme-spessartite .meta-text { color: #ff9e80; } .theme-spessartite .court-badge { background: #d84315; color: white; }
        .theme-demantoid { background: #33691e; color: #f1f8e9; border: 1px solid #558b2f; } .theme-demantoid .meta-text { color: #ccff90; } .theme-demantoid .court-badge { background: #558b2f; color: white; }
        .theme-padparadscha { background: #ffccbc; color: #bf360c; border: 1px solid #ff8a65; } .theme-padparadscha .court-badge { background: #bf360c; color: white; }

        .empty-state { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 3vw; color: rgba(255,255,255,0.3); font-weight: 900; text-transform: uppercase; letter-spacing: 5px; }
    </style>
</head>
<body>

    <div id="tv-header-container"></div>

    <div id="tv-grid">
        <div class="empty-state">MEMUAT LIVE SCORE...</div>
    </div>

    <script>
        document.body.addEventListener('dblclick', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => console.log("Gagal Fullscreen"));
            } else {
                document.exitFullscreen();
            }
        });

        const SUPABASE_URL = 'https://gubcvxiupehbdpigrdct.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_k1y6fNI2opEXhwqKMbGYcA__2nD0yT6';
        const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const urlParams = new URLSearchParams(window.location.search);
        let TOURNAMENT_ID = urlParams.get('id') || 'demo';
        
        let reqCourts = urlParams.get('courts'); 
        let targetCourts = reqCourts ? reqCourts.split(',').map(c => c.trim().toLowerCase()) : [];

        let matches = [];
        let cardPreset = 'classic-white';
        let hideServeGlobal = false;

        async function init() {
            const { data } = await db.from('partners').select('*').eq('tournament_id', TOURNAMENT_ID).maybeSingle();
            if (data) applyTheme(data); 
            await fetchMatches();
            subscribe();
        }

        function applyTheme(d) {
            const r = document.documentElement.style;
            r.setProperty('--font-main', d.font_family || 'Montserrat');
            r.setProperty('--primary-start', d.color_primary || '#222');
            r.setProperty('--primary-end', d.color_gradient_end || d.color_primary);
            r.setProperty('--live-neon', d.color_neon || '#76FF03');
            r.setProperty('--bg-color', d.color_bg || '#000000');
            document.body.style.backgroundColor = d.color_bg || '#000000';
            
            hideServeGlobal = (d.hide_serve === 'true');
            cardPreset = d.card_preset || 'classic-white'; 
            r.setProperty('--card-radius', (d.corner_radius || 15) + 'px');
            if(d.bg_image_url) { document.body.style.backgroundImage = `url('${d.bg_image_url}')`; document.body.style.backgroundSize = 'cover'; document.body.style.backgroundAttachment = 'fixed'; } 

            const tvTitle = d.tv_title || "";
            const tvSub = d.tv_sub || "";
            const tvTag = d.tv_tag || "";
            const tvLogo = d.tv_logo || "";
            const tvLogoPos = d.tv_logo_pos || "kiri";
            
            let cT = '#ffffff', sT = '1', xT = '0', yT = '0';
            let cS = '#ffeb3b', sS = '1', xS = '0', yS = '0';
            let cTag = '#ffffff', sTag = '1', xTag = '0', yTag = '0';
            let sL = '1', xL = '0', yL = '0';

            if(d.tv_style) {
                try {
                    let ts = JSON.parse(d.tv_style);
                    cT = ts.cT || '#ffffff'; sT = ts.sT || '1'; xT = ts.xT || '0'; yT = ts.yT || '0';
                    cS = ts.cS || '#ffeb3b'; sS = ts.sS || '1'; xS = ts.xS || '0'; yS = ts.yS || '0';
                    cTag = ts.cTag || '#ffffff'; sTag = ts.sTag || '1'; xTag = ts.xTag || '0'; yTag = ts.yTag || '0';
                    sL = ts.sL || '1'; xL = ts.xL || '0'; yL = ts.yL || '0';
                } catch(e) { console.error("Error parsing tv_style JSON", e); }
            }

            // --- EKSEKUSI TAMPILAN KLONING IDENTIK ---
            let tBase = (tvLogo && tvLogoPos === 'kiri') ? 12 : 3;
            let sBase = tBase + 28;
            let tagBase = sBase + 20;

            let logoHTML = '';
            if(tvLogo) {
                if(tvLogoPos === 'kiri') logoHTML = `<img src="${tvLogo}" style="position:absolute; top:50%; left:3vw; transform:translate(${xL}vw, calc(-50% + ${yL}vh)) scale(${sL}); transform-origin:left center; height:6vh; z-index:15; object-fit:contain;">`;
                else if(tvLogoPos === 'kanan') logoHTML = `<img src="${tvLogo}" style="position:absolute; top:50%; right:3vw; transform:translate(${xL}vw, calc(-50% + ${yL}vh)) scale(${sL}); transform-origin:right center; height:6vh; z-index:15; object-fit:contain;">`;
                else if(tvLogoPos === 'tengah') logoHTML = `<img src="${tvLogo}" style="position:absolute; top:50%; left:50%; transform:translate(calc(-50% + ${xL}vw), calc(-50% + ${yL}vh)) scale(${sL}); transform-origin:center center; height:25vh; opacity:0.15; z-index:1; pointer-events:none; object-fit:contain;">`;
            }

            let tHTML = tvTitle ? `<h1 style="position:absolute; top:50%; left:${tBase}vw; transform:translate(${xT}vw, calc(-50% + ${yT}vh)) scale(${sT}); transform-origin:left center; color:${cT}; margin:0; font-size:2.5vw; font-weight:900; letter-spacing:2px; text-transform:uppercase; text-shadow:0 4px 10px rgba(0,0,0,0.5); white-space:nowrap; z-index:15;">${tvTitle}</h1>` : '';
            
            let sHTML = tvSub ? `<span style="position:absolute; top:50%; left:${sBase}vw; transform:translate(${xS}vw, calc(-50% + ${yS}vh)) scale(${sS}); transform-origin:left center; color:${cS}; font-size:1.2vw; opacity:0.8; font-weight:700; text-shadow:0 2px 5px rgba(0,0,0,0.5); white-space:nowrap; z-index:15;">${tvSub}</span>` : '';
            
            let tagHTML = tvTag ? `<div style="position:absolute; top:50%; left:${tagBase}vw; transform:translate(${xTag}vw, calc(-50% + ${yTag}vh)) scale(${sTag}); transform-origin:left center; color:${cTag}; border:1px solid ${cTag}; padding:0.5vh 1.5vw; border-radius:30px; background:rgba(255,255,255,0.1); font-size:0.9vw; font-weight:800; text-transform:uppercase; letter-spacing:1px; backdrop-filter:blur(5px); z-index:15; white-space:nowrap;">${tvTag}</div>` : '';

            const h1 = d.color_primary || '#222';
            const h2 = d.color_gradient_end || d.color_primary || '#111';

            document.getElementById('tv-header-container').innerHTML = `
                <div style="background:linear-gradient(135deg, ${h1}, ${h2}); border-bottom:3px solid rgba(255,255,255,0.1); box-shadow:0 5px 15px rgba(0,0,0,0.5); height:10vh; position:relative; z-index:10; overflow:hidden; width:100%; flex-shrink:0;">
                    ${logoHTML}
                    ${tHTML}
                    ${sHTML}
                    ${tagHTML}
                </div>
            `;

            if (matches.length > 0) renderTV();
        }

        async function fetchMatches() {
            const { data: mData } = await db.from('matches_pro').select('*').eq('tournament_id', TOURNAMENT_ID).eq('status', 'LIVE').order('created_at', {ascending: true});
            if(mData) { 
                mData.sort((a, b) => new Date(a.created_at) - new Date(b.created_at)); 
                matches = mData; 
                renderTV(); 
            }
        }

        function formatTeamName(teamString, serverState, isTeamA) {
            const renderRow = (name, isServ) => {
                let dot = isServ ? '<span class="neon-dot"></span>' : '';
                let align = isTeamA ? 'left' : 'right';
                let dir = isTeamA ? 'row' : 'row-reverse';
                return `<div style="display:flex; flex-direction:${dir}; align-items:center; width:100%; min-width:0; gap:0.5vw;">
                            ${dot}
                            <span class="team-name" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex:1; text-align:${align};">${name}</span>
                        </div>`;
            };

            if(!teamString.includes('/')) {
                let isServing = !hideServeGlobal && (serverState === (isTeamA ? 'a' : 'b') || serverState === teamString);
                return `<div style="display:flex; flex-direction:column; width:100%; gap:1vh; min-width:0;">${renderRow(teamString, isServing)}</div>`;
            }

            let players = teamString.split('/').map(x => x.trim());
            let isS1 = !hideServeGlobal && (serverState === players[0]); 
            let isS2 = !hideServeGlobal && (serverState === players[1]);
            
            return `<div style="display:flex; flex-direction:column; width:100%; gap:1vh; min-width:0;">
                        ${renderRow(players[0], isS1)}
                        ${renderRow(players[1], isS2)}
                    </div>`;
        }

        function renderTV() {
            const gridEl = document.getElementById('tv-grid');
            
            let liveMatches = matches;
            if (targetCourts.length > 0) {
                liveMatches = matches.filter(m => targetCourts.includes(String(m.court_name).trim().toLowerCase()));
            }

            if (liveMatches.length === 0) {
                gridEl.className = 'grid-1';
                let txt = targetCourts.length > 0 ? `TIDAK ADA PERTANDINGAN LIVE DI COURT TERPILIH` : `BELUM ADA PERTANDINGAN LIVE`;
                gridEl.innerHTML = `<div class="empty-state">${txt}</div>`;
                return;
            }

            gridEl.className = ''; 
            if (liveMatches.length === 1) gridEl.classList.add('grid-1');
            else if (liveMatches.length === 2) gridEl.classList.add('grid-2');
            else if (liveMatches.length === 3) gridEl.classList.add('grid-3');
            else if (liveMatches.length === 4) gridEl.classList.add('grid-4');
            else if (liveMatches.length <= 6) gridEl.classList.add('grid-6');
            else gridEl.classList.add('grid-many');

            gridEl.innerHTML = "";

            liveMatches.forEach(m => {
                let sets = []; let maxSet = m.current_set || 1;
                for(let i=1; i<=5; i++) {
                    let sa = parseInt(m[`set${i}_a`]) || 0; let sb = parseInt(m[`set${i}_b`]) || 0; let isCurr = ((m.current_set || 1) == i);
                    if (isCurr || sa > 0 || sb > 0 || (i === 1 && maxSet === 1)) {
                        if (isCurr) { sets.push(`<span class="set-txt" style="color:var(--live-neon); text-shadow: 0 0 10px rgba(0,0,0,0.8);">${sa}-${sb}</span>`); } 
                        else { sets.push(`<span class="set-txt">${sa}-${sb}</span>`); }
                    }
                }
                if(sets.length === 0) sets.push(`<span class="set-txt">0-0</span>`);
                
                let scoreStr = `<div style="display:flex; flex-wrap:wrap; justify-content:center; gap:0.8vw; align-items:center; line-height:1.2;">` + sets.join('<span style="opacity:0.3; font-size:0.6em;">•</span>') + `</div>`;
                
                let smallPt = `<div class="point-txt"><span style="color:var(--live-neon)">${m.points_a||0} - ${m.points_b||0}</span></div>`;

                let themeClass = 'theme-' + cardPreset;
                let metaHTML = `<span class="meta-text">${m.category} • ${m.round}</span>`;
                let timeInfo = '<div class="live-tag"><div class="dot-live"></div> LIVE</div>'; 

                let teamA_Formatted = formatTeamName(m.team_a, m.server, true);
                let teamB_Formatted = formatTeamName(m.team_b, m.server, false);

                gridEl.innerHTML += `
                <div class="match-card ${themeClass} is-live">
                    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid rgba(0,0,0,0.1); padding-bottom:1vh; margin-bottom:1.5vh; min-width:0;">
                        ${metaHTML} ${timeInfo}
                    </div>
                    <div style="display:flex; align-items:center; justify-content:space-between; flex:1; gap:1vw; min-width:0; min-height:0;">
                        <div class="team" style="align-items:flex-start;">${teamA_Formatted}</div>
                        
                        <div class="score-pill">${scoreStr}${smallPt}</div>
                        
                        <div class="team" style="align-items:flex-end;">${teamB_Formatted}</div>
                    </div>
                    <div style="text-align:center; margin-top:1.5vh; min-width:0;">
                        <span class="court-badge">${m.court_name}</span>
                    </div>
                </div>`;
            });
        }

        let fetchTimeout = null;
        function triggerFetch() { clearTimeout(fetchTimeout); fetchTimeout = setTimeout(() => { fetchMatches(); }, 500); }
        
        function subscribe() {
            db.channel('public:matches_pro').on('postgres_changes', {event:'*', schema:'public', table:'matches_pro', filter:`tournament_id=eq.${TOURNAMENT_ID}`}, ()=>triggerFetch()).subscribe();
            db.channel('public:partners').on('postgres_changes', {event:'UPDATE', schema:'public', table:'partners', filter:`tournament_id=eq.${TOURNAMENT_ID}`}, (p)=>applyTheme(p.new)).subscribe();
        }
        
        init();
    </script>
</body>
</html>